Bootstrap: docker

From: centos:7

%post

## Installation variables, including versions of the software to install.

INSTALL_DIR=/opt
BUILD_DIR=/tmp/alignment_software_build

BEDTOOLS=2.29.2
BWA=0.7.17
BWAMEM=2.1
PICARD=2.9.5
SAMTOOLS=1.11
STAR=2.7.7a

TAROPTS="--no-same-owner --no-same-permissions"

echo "LANG=en_US.utf8" > /etc/locale.conf
export LANG=en_US.utf8
export LC_CTYPE=en_US
export LC_TIME=$LC_CTYPE
export LC_COLLATE=$LC_CTYPE
export LC_MESSAGES=$LC_CTYPE 
export LC_MONETARY=$LC_CTYPE 
export LC_PAPER=$LC_CTYPE 
export LC_MEASUREMENT=$LC_CTYPE 

yum update -y
yum install -y \
	bc bzip2 bzip2-devel cmake gcc-c++ gzip java-11-openjdk-headless \
	libcurl-devel make ncurses-devel openssl-devel perl \
	R-core tar unzip wget xz-devel zlib-devel

mkdir -p ${INSTALL_DIR} ${BUILD_DIR}

# samtools
cd ${BUILD_DIR}
wget https://github.com/samtools/samtools/releases/download/${SAMTOOLS}/samtools-${SAMTOOLS}.tar.bz2
tar ${TAROPTS} -jxf samtools-${SAMTOOLS}.tar.bz2
cd ${BUILD_DIR}/samtools-${SAMTOOLS}
./configure --prefix=${INSTALL_DIR}/samtools-${SAMTOOLS} && \
make && \
make install

# bedtools2
cd ${BUILD_DIR}
wget https://github.com/arq5x/bedtools2/releases/download/v${BEDTOOLS}/bedtools-${BEDTOOLS}.tar.gz
tar ${TAROPTS} -xzf ${BUILD_DIR}/bedtools-${BEDTOOLS}.tar.gz
cd ${BUILD_DIR}/bedtools2
make install prefix="" DESTDIR=${INSTALL_DIR}/bedtools-${BEDTOOLS}

# BWA
cd ${BUILD_DIR}
wget https://github.com/lh3/bwa/releases/download/v${BWA}/bwa-${BWA}.tar.bz2
cd ${INSTALL_DIR}
tar ${TAROPTS} -jxf ${BUILD_DIR}/bwa-${BWA}.tar.bz2
cd ${INSTALL_DIR}/bwa-${BWA}
make

# BWA-mem2
cd ${BUILD_DIR}
wget https://github.com/bwa-mem2/bwa-mem2/releases/download/v${BWAMEM}/bwa-mem2-${BWAMEM}_x64-linux.tar.bz2
cd ${INSTALL_DIR}
tar ${TAROPTS} -jxf ${BUILD_DIR}/bwa-mem2-${BWAMEM}_x64-linux.tar.bz2
mv bwa-mem2-${BWAMEM}_x64-linux bwa-mem2-${BWAMEM}

# STAR
cd ${BUILD_DIR}
wget -O STAR-${STAR}.tar.gz https://github.com/alexdobin/STAR/archive/${STAR}.tar.gz
cd ${INSTALL_DIR}
tar ${TAROPTS} -xzf ${BUILD_DIR}/STAR-${STAR}.tar.gz

# UCSC Tools
mkdir ${INSTALL_DIR}/ucsc_tools
cd ${INSTALL_DIR}/ucsc_tools
wget http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/bedGraphToBigWig
wget http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/bedSort
chmod a+rx *

# Picard
cd ${INSTALL_DIR}
wget -O picard-${PICARD}.jar https://github.com/broadinstitute/picard/releases/download/${PICARD}/picard.jar

cd /
rm -rf ${BUILD_DIR}


%test

INSTALL_DIR=/opt
BEDTOOLS=2.29.2
BWA=0.7.17
PICARD=2.9.5
SAMTOOLS=1.11
STAR=2.7.7a

if [ ! -e ${INSTALL_DIR}/samtools-${SAMTOOLS}/bin/samtools ]
then
    echo "Samtools has not installed correctly." >&2
fi

if [ ! -e ${INSTALL_DIR}/bedtools-${BEDTOOLS}/bin/bamToFastq ]
then
    echo "Bedtools has not installed correctly." >&2
fi

if [ ! -e ${INSTALL_DIR}/bwa-${BWA}/bwa ]
then
    echo "BWA has not installed correctly." >&2
fi
